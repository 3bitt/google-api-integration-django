{% extends 'base.html' %}
{% load static %}
{% block bootstrap5_extra_head %}
<link rel="stylesheet" href="{% static 'css/fetch_books.css' %}">
{% endblock bootstrap5_extra_head %}

{% block content %}

<div class="container">

    <div class="row mt-3">
        <div class="col-auto">
            <h3 class="m-0">Search for books</h3>
        </div>
    </div>

    <div class="row mt-5 pb-3 border-bottom">
        <form action="{% url 'import:import' %}" method="post">
            {%csrf_token%}

            <div class="row mb-2 border-bottom">
                <div class="col-auto pe-1">
                    <h5>Filters</h5>
                </div>
            </div>

            <div class="row mb-2">
                <div class="col-2">
                    Contains text:
                </div>
                <div class="col">
                    <input type="text" name="intext" value="{{user_input.intext}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    Title:
                </div>
                <div class="col">
                    <input type="text" name="intitle" value="{{user_input.intitle}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    Author:
                </div>
                <div class="col">
                    <input type="text" name="inauthor" value="{{user_input.inauthor}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    Publisher:
                </div>
                <div class="col">
                    <input type="text" name="inpublisher" value="{{user_input.inpublisher}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    Category:
                </div>
                <div class="col">
                    <input type="text" name="subject" value="{{user_input.subject}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    ISBN:
                </div>
                <div class="col">
                    <input type="text" name="isbn" value="{{user_input.isbn}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    Library of Congress<br>Control Number:
                </div>
                <div class="col align-self-center">
                    <input type="text" name="lccn" value="{{user_input.lccn}}">
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-2">
                    Online Computer Library Center number:
                </div>
                <div class="col align-self-center">
                    <input type="text" name="oclc" value="{{user_input.oclc}}">
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-auto">
                    <input class="btn btn-primary" type="submit" value="Search">
                </div>
            </div>
        </form>
    </div>

    <div class="row">
        {% if view.success_import %}
            <div><h4 class="text-success"><b>Import successfull</b></h4></div>
        {% endif %}
        {% if data.totalItems > 0 %}
        <div class="row mt-4">
            <div class="col-auto ms-auto">
                <form method="post" action="{% url 'import:save-resource' api_resource %}">
                    {% csrf_token %}
                    <input class="btn btn-success" type="submit" value="Import">
                </form>                
            </div>
        </div>
        <div class="row mt-4">
            <table class="table table-bordered table-sm table-striped">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="table-title-col">Title</th>
                        <th scope="col" class="table-author-col">Author</th>
                        <th scope="col">Publish date</th>
                        <th scope="col">Identifier<br><small>(type : number)</small></th>
                        <th scope="col">Page count</th>
                        <th scope="col">Language</th>
                        <th scope="col">Thumbnail</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in data.items %}
                    <tr>
                        <th scope="row">{{forloop.counter}}</th>
                        <td>{{book.volumeInfo.title}}</td>
                        <td>
                            {% for author in book.volumeInfo.authors %}
                            <div>{{author}}</div>
                            {% endfor %}
                        </td>
                        <td>{{book.volumeInfo.publishedDate}}</td>
                        <td>
                            {% for isbn in book.volumeInfo.industryIdentifiers %}
                            <div>{{isbn.type}} : {{isbn.identifier}}</div>
                            {% endfor %}
                        </td>
                        <td>{{book.volumeInfo.pageCount}}</td>
                        <td>{{book.volumeInfo.language}}</td>
                        <td><img src="{{book.volumeInfo.imageLinks.thumbnail}}" alt=""></td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>

        </div>
        {% elif user_input %}
        <div class="mt-3">
            <h4 class="text-danger">0 books found</h4>
        </div>
        {% else %}

        {% endif %}
    </div>

</div>


{% endblock content %}